<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Vitrine de Suplementos</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f6f6f6;
            margin: 0;
            padding: 20px;
        }

        h1 { text-align: center; }

        .produtos {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .produto {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .produto img {
            width: 100%;
            max-height: 160px;
            object-fit: contain;
        }

        button {
            background: #25d366;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }

        #btn-carrinho {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #000;
            color: #fff;
            padding: 14px 18px;
            border-radius: 50px;
            cursor: pointer;
            z-index: 999;
        }

        #modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
        }

        #modal-conteudo {
            background: white;
            max-width: 400px;
            margin: 80px auto;
            padding: 20px;
            border-radius: 8px;
        }

        .item {
            border-bottom: 1px solid #ddd;
            padding: 6px 0;
        }
    </style>
</head>

<body>

<h1>ðŸ›’ Vitrine de Suplementos</h1>

<div class="produtos">
    {% for p in produtos %}
    <div class="produto">
        <img src="{{ p.imagem }}" alt="{{ p.nome }}">
        <h3>{{ p.nome }}</h3>
        <p>R$ {{ "%.2f"|format(p.preco) }}</p>

        <button 
            data-nome="{{ p.nome }}"
            data-preco="{{ p.preco }}"
            onclick="addCarrinho(this)">
            Adicionar ao carrinho
        </button>
    </div>
    {% endfor %}
</div>

<div id="btn-carrinho" onclick="abrirCarrinho()">ðŸ›’ Ver carrinho</div>

<div id="modal">
    <div id="modal-conteudo">
        <h3>Seu carrinho</h3>
        <div id="lista"></div>

        <button onclick="finalizarWhatsApp()">Finalizar no WhatsApp</button>
        <button onclick="fecharCarrinho()" style="background:#999;margin-top:8px">Fechar</button>
    </div>
</div>

<script>
    let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];

    function addCarrinho(btn) {
        const nome = btn.dataset.nome;
        const preco = parseFloat(btn.dataset.preco);

        carrinho.push({ nome, preco });
        localStorage.setItem("carrinho", JSON.stringify(carrinho));
        alert("Produto adicionado ao carrinho!");
    }

    function abrirCarrinho() {
        document.getElementById("modal").style.display = "block";
        renderCarrinho();
    }

    function fecharCarrinho() {
        document.getElementById("modal").style.display = "none";
    }

    function renderCarrinho() {
        const lista = document.getElementById("lista");
        lista.innerHTML = "";

        let total = 0;

        carrinho.forEach(item => {
            total += item.preco;
            lista.innerHTML += `
                <div class="item">
                    ${item.nome} - R$ ${item.preco.toFixed(2)}
                </div>
            `;
        });

        lista.innerHTML += `<strong>Total: R$ ${total.toFixed(2)}</strong>`;
    }

    function finalizarWhatsApp() {
        if (carrinho.length === 0) {
            alert("Carrinho vazio");
            return;
        }

        let mensagem = "ðŸ›’ *Pedido - Vitrine de Suplementos*%0A%0A";
        let total = 0;

        carrinho.forEach(item => {
            mensagem += `â€¢ ${item.nome} - R$ ${item.preco.toFixed(2)}%0A`;
            total += item.preco;
        });

        mensagem += `%0A*Total:* R$ ${total.toFixed(2)}`;

        const numero = "5522981106356";
        window.open(`https://wa.me/${numero}?text=${mensagem}`, "_blank");
    }
</script>

</body>
</html>
